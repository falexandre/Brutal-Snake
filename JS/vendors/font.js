/** Font.js v2012.01.25 (c) Mike "Pomax" Kamermans, 2012 Licensed under MIT ("expat" flavour) license. Hosted on http://github.com/Pomax/Font.js **/
(function(e){function t(){this.fontFamily="fjs"+(999999*Math.random()|0)}if(!Object.defineProperty){throw"Font.js requires Object.defineProperty, which this browser does not support."}if(!document.createElement("canvas").getContext){throw"Font.js requires <canvas> and the Canvas2D API, which this browser does not support."}(function(e){function r(e,t){return this.slice(e,t)}function i(e,t){var n,r=e.length;if(arguments.length<2){t=0}for(n=0;n<r;++n,++t){this[t]=e[n]&255}}function s(e){var t,n;if(typeof e==="number"){t=new Array(e);for(n=0;n<e;++n){t[n]=0}}else{t=e.slice(0)}t.subarray=r;t.buffer=t;t.byteLength=t.length;t.set=i;if(typeof e==="object"&&e.buffer){t.buffer=e.buffer}return t}try{var t=new Uint8Array(1);return}catch(n){}e.Uint8Array=s;e.Uint32Array=s;e.Int32Array=s})(e);(function(e){if(e.opera)return;if("response"in XMLHttpRequest.prototype||"mozResponseArrayBuffer"in XMLHttpRequest.prototype||"mozResponse"in XMLHttpRequest.prototype||"responseArrayBuffer"in XMLHttpRequest.prototype){return}var t;if(e.VBArray){t=function(){return new Uint8Array((new VBArray(this.responseBody)).toArray())}}else{t=function(){this.responseBody}}Object.defineProperty(XMLHttpRequest.prototype,"response",{get:t})})(e);if(!e.btoa){e.btoa=function(e){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var n,r,i,s,o,u,a,f,l=0,c=0,h="",p=[];if(!e){return e}do{n=e.charCodeAt(l++);r=e.charCodeAt(l++);i=e.charCodeAt(l++);f=n<<16|r<<8|i;s=f>>18&63;o=f>>12&63;u=f>>6&63;a=f&63;p[c++]=t.charAt(s)+t.charAt(o)+t.charAt(u)+t.charAt(a)}while(l<e.length);h=p.join("");var d=e.length%3;return(d?h.slice(0,d-3):h)+"===".slice(d||3)}}t.prototype.url="";t.prototype.format="";t.prototype.data="";t.prototype.base64="AAEAAAAKAIAAAwAgT1MvMgAAAAAAAACsAAAAWGNtYXAA"+"AAAAAAABBAAAACxnbHlmAAAAAAAAATAAAAAQaGVhZAAAA"+"AAAAAFAAAAAOGhoZWEAAAAAAAABeAAAACRobXR4AAAAAA"+"AAAZwAAAAIbG9jYQAAAAAAAAGkAAAACG1heHAAAAAAAAA"+"BrAAAACBuYW1lAAAAAAAAAcwAAAAgcG9zdAAAAAAAAAHs"+"AAAAEAAEAAEAZAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"+"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"+"AAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAABAAMAAQA"+"AAAwABAAgAAAABAAEAAEAAABB//8AAABB////wAABAAAA"+"AAABAAAAAAAAAAAAAAAAMQAAAQAAAAAAAAAAAABfDzz1A"+"AAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAEAAg"+"AAAAAAAAABAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAA"+"AAAAAAAAAAQAAAAAAAAAAAAAAAAAIAAAAAQAAAAIAAQAB"+"AAAAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAIAHgADAAEEC"+"QABAAAAAAADAAEECQACAAIAAAAAAAEAAAAAAAAAAAAAAA"+"AAAA==";t.prototype.metrics={quadsize:0,leading:0,ascent:0,descent:0,weightclass:400};t.prototype.systemfont=false;t.prototype.loaded=false;t.prototype.onload=function(){};t.prototype.onerror=function(){};t.prototype.canvas=false;t.prototype.context=false;t.prototype.validate=function(e,t,n,r,i){if(i!==false&&i<0){this.onerror("Requested system font '"+this.fontFamily+"' could not be loaded (it may not be installed).");return}var s=document.defaultView.getComputedStyle(e,"");var o=s.getPropertyValue("width").replace("px","");if(o>0){document.head.removeChild(t);document.body.removeChild(e);this.loaded=true;this.onload()}else{setTimeout(function(){r.validate(e,t,n,r,i===false?false:i-50)},50)}};t.prototype.ondownloaded=function(){var e=this;var t=function(e){return String.fromCharCode(e)};var n=function(e){if(e<256){return t(0)+t(e)}var n=e>>8;var r=e&255;return t(n)+t(r)};var r=function(e){if(e<0){e=4294967295+e+1}return parseInt(e,10).toString(16)};var i=function(e,t){return 256*e+t};var s=function(e,t){var n=e>>7===1,r;e=e&127;r=256*e+t;if(!n){return r}return r-32768};var o=function(e,t,n,r){return 16777216*e+65536*t+256*n+r};var u=function(t){e.onerror(t)};var a=t(0)+t(1)+t(0)+t(0);var f="OTTO";var l=this.data;var c=t(l[0])+t(l[1])+t(l[2])+t(l[3]);var h=c===a;var p=h?false:c===f;if(h){this.format="truetype"}else if(p){this.format="opentype"}else{u("Error: file at "+this.url+" cannot be interpreted as OpenType font.");return}var d=i(l[4],l[5]),v=12,m,g=v+16*d,y={},b;for(m=v;m<g;m+=16){b=t(l[m])+t(l[m+1])+t(l[m+2])+t(l[m+3]);y[b]={name:b,checksum:o(l[m+4],l[m+5],l[m+6],l[m+7]),offset:o(l[m+8],l[m+9],l[m+10],l[m+11]),length:o(l[m+12],l[m+13],l[m+14],l[m+15])}}var w=function(e){if(!y[e]){u("Error: font is missing the required OpenType '"+e+"' table.");return false}return e};b=w("head");if(b===false){return}m=y[b].offset;y[b].version=""+l[m]+l[m+1]+l[m+2]+l[m+3];var E=i(l[m+18],l[m+19]);this.metrics.quadsize=E;b=w("hhea");if(b===false){return}m=y[b].offset;y[b].version=""+l[m]+l[m+1]+l[m+2]+l[m+3];this.metrics.ascent=s(l[m+4],l[m+5])/E;this.metrics.descent=s(l[m+6],l[m+7])/E;this.metrics.leading=s(l[m+8],l[m+9])/E;b=w("OS/2");if(b===false){return}m=y[b].offset;y[b].version=""+l[m]+l[m+1];this.metrics.weightclass=i(l[m+4],l[m+5]);b=w("cmap");if(b===false){return}m=y[b].offset;y[b].version=""+l[m]+l[m+1];d=i(l[m+2],l[m+3]);var S,x,T,N,C,k=false;for(var S=0;S<d;S++){x=m+4+S*8;T=i(l[x],l[x+1]);N=i(l[x+2],l[x+3]);C=o(l[x+4],l[x+5],l[x+6],l[x+7]);if(T===3&&N===1){k=C}}var L="A";if(k!==false){m+=k;c=i(l[m],l[m+1]);if(c===4){var A=i(l[m+6],l[m+7])/2;var O=function(e){return[9,10,11,12,13,32,133,160,5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8232,8233,8239,8287,12288].indexOf(e)===-1};var M=m+14,_=m+14+2*A,D=false;for(;M<_;M+=2){D=i(l[M],l[M+1]);if(O(D)){break}D=false}if(D!==false){L=String.fromCharCode(D);var P=-(D-1)+65536;var H=btoa(t(0)+n(D)+n(65535)+n(0)+n(D)+n(65535)+n(P)+n(1));this.base64=this.base64.substring(0,380)+H+this.base64.substring(380+H.length)}}}this.bootstrapValidation(L,false)};t.prototype.bootstrapValidation=function(e,t){var n=this.fontFamily+" testfont";var r=document.createElement("style");r.setAttribute("type","text/css");r.innerHTML="@font-face {\n"+"  font-family: '"+n+"';\n"+"  src: url('data:application/x-font-ttf;base64,"+this.base64+"')\n"+"       format('truetype');}";document.head.appendChild(r);var i=false;if(!this.systemfont){i=this.toStyleNode();document.head.appendChild(i)}var s=document.createElement("p");s.style.cssText="position: absolute; top: 0; left: 0; opacity: 0;";s.style.fontFamily="'"+this.fontFamily+"', '"+n+"'";s.innerHTML=e+e+e+e+e+e+e+e+e+e;document.body.appendChild(s);if(!document.defaultView.getComputedStyle){this.onload();error("Error: document.defaultView.getComputedStyle is not supported by this browser.\n"+"Consequently, Font.onload() cannot be trusted.")}else{var o=this.systemfont?1e3:this.metrics.quadsize;var u=document.createElement("canvas");u.width=o;u.height=o;this.canvas=u;var a=u.getContext("2d");a.font="1em '"+this.fontFamily+"'";a.fillStyle="white";a.fillRect(-1,-1,o+2,o+2);a.fillStyle="black";a.fillText("test text",50,o/2);this.context=a;var f=this;var l=function(){f.validate(s,r,i,f,t)};setTimeout(l,50)}};t.prototype.processSystemFont=function(){this.systemfont=true;this.metrics=false;this.bootstrapValidation("A",1e3)};t.prototype.loadFont=function(){var e=this;if(this.url.indexOf(".")===-1){setTimeout(function(){e.processSystemFont()},10);return}var t=new XMLHttpRequest;t.open("GET",e.url,true);t.responseType="arraybuffer";t.onload=function(n){var r=t.response;if(r){e.data=new Uint8Array(r);e.ondownloaded()}else{e.onerror("Error downloading font resource from "+e.url)}};t.send(null)};t.prototype.styleNode=false;t.prototype.toStyleNode=function(){if(this.styleNode){return this.styleNode}this.styleNode=document.createElement("style");this.styleNode.type="text/css";var e="@font-face {\n";e+="  font-family: '"+this.fontFamily+"';\n";e+="  src: url('"+this.url+"') format('"+this.format+"');\n";e+="}";this.styleNode.innerHTML=e;return this.styleNode};t.prototype.measureText=function(e,t){if(!this.loaded){error("measureText() was called while the font was not yet loaded");return false}this.context.font=t+"px '"+this.fontFamily+"'";var n=this.context.measureText(e);n.fontsize=t;n.ascent=0;n.descent=0;n.bounds={minx:0,maxx:n.width,miny:0,maxy:0};n.height=0;var r=[],i=n.width/this.metrics.quadsize;if(i<=1){r.push(e)}else{r.push(e)}var s=r.length,o;for(o=0;o<s;o++){this.measureSegment(r[o],t,n)}return n};t.prototype.measureSegment=function(e,t,n){var r=function(e,t){return document.defaultView.getComputedStyle(e,null).getPropertyValue(t)};var i;var s=document.createElement("div");s.style.position="absolute";s.style.opacity=0;s.style.font=t+"px '"+this.fontFamily+"'";var o=10;s.innerHTML=e;for(i=1;i<o;i++){s.innerHTML+="<br/>"+e}document.body.appendChild(s);n.leading=1.2*t;var u=r(s,"height");u=u.replace("px","");if(u>=t*o){n.leading=u/o|0}document.body.removeChild(s);if(/^\s*$/.test(e)){return n}var a=this.canvas,f=this.context,l=this.systemfont?1e3:this.metrics.quadsize,c=l,h=l,p=l/2,d=50,v=(l-n.width)/2;if(v!==(v|0)){v=v|0}f.fillStyle="white";f.fillRect(-d,-d,c+2*d,h+2*d);f.fillStyle="black";f.fillText(e,v,p);var m=n.width+d|0,g=4*t,y=v-d/2,b=p-g/2,w=f.getImageData(y,b,m,g).data;var i=0,E=0,S=m*4,x=w.length,T=g/2;while(++i<x&&w[i]===255){}var N=i/S|0;i=x-1;while(--i>0&&w[i]===255){}var C=i/S|0;for(i=0,E=0;E<m&&w[i]===255;){i+=S;if(i>=x){E++;i=i-x+4}}var k=E;var L=1;for(i=x-3,E=0;E<m&&w[i]===255;){i-=S;if(i<0){E++;i=x-3-L++*4}}var A=m-E;n.ascent=T-N;n.descent=C-T;n.bounds={minx:k-d/2,maxx:A-d/2,miny:-n.descent,maxy:n.ascent};n.height=1+(C-N);return n};Object.defineProperty(t.prototype,"src",{set:function(e){this.url=e;this.loadFont()}});e.Font=t})(window)